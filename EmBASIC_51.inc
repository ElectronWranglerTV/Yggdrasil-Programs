;* Yggdrasil (TM) Core Operating System: EmBASIC Embedded BASIC for 8051 Include File
;* Copyright (C) DeRemee Systems, IXE Electronics LLC
;* Portions copyright IXE Electronics LLC, Republic Robotics, FemtoLaunch, FemtoSat, FemtoTrack, Weland
;* This work is made available under the Creative Commons Attribution-NonCommercial-ShareAlike 4.0 International License.
;* To view a copy of this license, visit http://creativecommons.org/licenses/by-nc-sa/4.0/.

;SIZE OF INPUT BUFFER, IN BYTES
INPUT_BUFFER_SIZE								EQU 0x40
;DEFAULT AUTOMATIC LINE NUMBER STEP VALUE
LINE_STEP_VALUE									EQU	0x0A

;MEMORY LAYOUT
;+---------------------------+
;|     TASK CONTROL BLOCK    |
;+---------------------------+
;|        INPUT BUFFER       |
;+---------------------------+
;|         LINE INDEX        |
;+---------------------------+
;|        SYMBOL TABLE       |
;+---------------------------+
;|        LINE BUFFER        |
;+---------------------------+
;LINE INDEX HOLDS LINE NUMBER INFORMATION
;SYMBOL TABLE HOLDS VARIABLE NAME AND LABEL STRINGS AND THE ID USED TO REFERENCE THEM
;LINE BUFFER HOLDS THE CONTENTS OF LINES
BASIC_MEM_OFFS_TCB							EQU	0x00
BASIC_MEM_OFFS_INBUFFER					EQU	BASIC_MEM_OFFS_TCB + BASIC_TCB_SIZE
BASIC_MEM_OFFS_LINE_INDEX				EQU	BASIC_MEM_OFFS_INBUFFER + INPUT_BUFFER_SIZE


;BASIC CONTROL STATUS BLOCK FORMAT
;+---------------------------+
;|           FLAGS           |
;+---------------------------+
;|   LINE INDEX POINTER LSB  |
;+---------------------------+
;|   LINE INDEX POINTER MSB  |
;+---------------------------+
;|     LINE COUNT (N) LSB    |
;+---------------------------+
;|     LINE COUNT (N) MSB    |
;+---------------------------+
;|  CURRENT LINE NUMBER LSB  |
;+---------------------------+
;|  CURRENT LINE NUMBER MSB  |
;+---------------------------+
;|    CONTENT POINTER LSB    |
;+---------------------------+
;|    CONTENT POINTER MSB    |
;+---------------------------+
;|      LINE STEP VALUE      |
;+---------------------------+
;|      INPUT FIFO ID        |
;+---------------------------+
BASIC_TCB_START									EQU	0x00
	BASIC_TCB_OFFS_FLAGS					EQU	0x00
	BASIC_TCB_OFFS_PTR_LINEINDEX	EQU	0x01
	BASIC_TCB_OFFS_LINECOUNT			EQU	0x03
	BASIC_TCB_OFFS_CURRLINE				EQU	0x05
	BASIC_TCB_OFFS_PTR_CONTENT		EQU	0x07
	BASIC_TCB_OFFS_LINESTEP				EQU	0x09
	BASIC_TCB_OFFS_INPUT_FIFO			EQU	0x0A
BASIC_TCB_END										EQU	0x0B
BASIC_TCB_SIZE									EQU	BASIC_TCB_END - BASIC_TCB_START

;LINE INDEX FORMAT
;+---------------------------+
;|     LINE NUMBER 0 LSB     |
;+---------------------------+
;|     LINE NUMBER 0 MSB     |
;+---------------------------+
;|   CONTENT POINTER 0 LSB   |
;+---------------------------+
;|   CONTENT POINTER 0 MSB   |
;+---------------------------+
;|     LINE NUMBER 1 LSB     |
;+---------------------------+
;|     LINE NUMBER 1 MSB     |
;+---------------------------+
;|   CONTENT POINTER 1 LSB   |
;+---------------------------+
;|   CONTENT POINTER 1 MSB   |
;+---------------------------+
;|   LINE NUMBER N - 2 LSB   |
;+---------------------------+
;|   LINE NUMBER N - 2 MSB   |
;+---------------------------+
;| CONTENT POINTER N - 2 LSB |
;+---------------------------+
;| CONTENT POINTER N - 2 MSB |
;+---------------------------+
;|   LINE NUMBER N - 1 LSB   |
;+---------------------------+
;|   LINE NUMBER N - 1 MSB   |
;+---------------------------+
;| CONTENT POINTER N - 1 LSB |
;+---------------------------+
;| CONTENT POINTER N - 1 MSB |
;+---------------------------+
BASIC_LINDX_ENTRY_START					EQU	0x00
	BASIC_LINDX_OFFS_NUMBER				EQU	0x00
	BASIC_LINDX_OFFS_POINTER			EQU	0x02
BASIC_LINDX_ENTRY_END						EQU	0x04
BASIC_LINDX_ENTRY_SIZE					EQU	BASIC_LINDX_ENTRY_END - BASIC_LINDX_ENTRY_SIZE

;VARIABLE ENTRY FORMAT
;+------------------+
;|  VALUE ADDRESS   |
;+------------------+
;|  VARIABLE TYPE   |
;+------------------+
;| NAME POINTER LSB |
;+------------------+
;| NAME POINTER MSB |
;+------------------+

;| NAME LENGTH (n) |
;+-----------------+
;|   NAME BYTE 0   |
;+-----------------+
;+-----------------+
;|   NAME BYTE n   |
;+-----------------+

BASICTOKEN	SET	0

;ARITHMETIC OPERATORS
BASICARITHS:
	DB	(BASICARITHSEND - BASICARITHS) / 5
		;FACTORIAL
		DW	BASICSTRAFAC
		DB	BASICTOKEN
		DW	BASICARITHFAC
		BASICTOKEN	SET	BASICTOKEN + 1
		;MULTIPLY
		DW	BASICSTRAMUL
		DB	BASICTOKEN
		DW	BASICARITHMUL
		BASICTOKEN	SET	BASICTOKEN + 1
		;DIVIDE
		DW	BASICSTRADIV
		DB	BASICTOKEN
		DW	BASICARITHDIV
		BASICTOKEN	SET	BASICTOKEN + 1
		;ADD
		DW	BASICSTRAADD
		DB	BASICTOKEN
		DW	BASICARITHADD
		BASICTOKEN	SET	BASICTOKEN + 1
		;SUBTRACT
		DW	BASICSTRASUB
		DB	BASICTOKEN
		DW	BASICARITHSUB
		BASICTOKEN	SET	BASICTOKEN + 1
BASICARITHSEND:

;ASSIGNMENT OPERATORS
BASICASSIGNS:
	DB	(BASICASSIGNSEND - BASICASSIGNS) / 5
		DW	BASICSTRASS
		DB	BASICTOKEN
		DW	BASICASSIGN
		BASICTOKEN	SET	BASICTOKEN + 1
BASICASSIGNSEND:

;BASIC COMMANDS
BASICCOMMANDS:
	DB	(BASICCOMMANDSEND - BASICCOMMANDS) / 5
		;LIST
		DW	BASICSTRLIST
		DB	BASICTOKEN
		DW	BASICCMDLIST
		BASICTOKEN	SET	BASICTOKEN + 1
		;RUN
		DW	BASICSTRRUN
		DB	BASICTOKEN
		DW	BASICCMDRUN
		BASICTOKEN	SET	BASICTOKEN + 1
		;NEW
		DW	BASICSTRNEW
		DB	BASICTOKEN
		DW	BASICCMDNEW
		BASICTOKEN	SET	BASICTOKEN + 1
BASICCOMMANDSEND:

;BASIC DATATYPES
BASICTYPES:
	BASICTYPEBIT		EQU	0x01
	BASICTYPEBYTE		EQU	0x02
	BASICTYPEWORD		EQU	0x03
	BASICTYPEDW			EQU	0x04
	BASICTYPEQW			EQU	0x05
	BASICTYPEDQ			EQU	0x06
	BASICTYPESHORT	EQU	0x10
	BASICTYPEFLOAT	EQU	0x20
	BASICTYPECHAR		EQU	0x30
	BASICTYPESTRING	EQU	0x31

;KEYWORDS
BASICKEYWORDS:
	DB	(BASICKEYWORDSEND - BASICKEYWORDS) / 5
		;ABSOLUTE VALUE (ABS)
		DB	BASICTOKEN
		DW	BASICSTRABS
		DW	BASICKEYABS
		BASICTOKEN	SET	BASICTOKEN + 1
		;EXPONENT (EXP)
		DB	BASICTOKEN
		DW	BASICSTREXP
		DW	BASICKEYEXP
		BASICTOKEN	SET	BASICTOKEN + 1
		;FOR
		DW	BASICSTRFOR
		DB	BASICTOKEN
		DW	BASICKEYFOR
		BASICTOKEN	SET	BASICTOKEN + 1
		;GOSUB
		DW	BASICSTRGOSUB
		DB	BASICTOKEN
		DW	BASICKEYGOSUB
		BASICTOKEN	SET	BASICTOKEN + 1
		;GOTO
		DW	BASICSTRGOTO
		DB	BASICTOKEN
		DW	BASICKEYGOTO
		BASICTOKEN	SET	BASICTOKEN + 1
		;IF
		DW	BASICSTRIF
		DB	BASICTOKEN
		DW	BASICKEYIF
		BASICTOKEN	SET	BASICTOKEN + 1
		;INPUT
		DW	BASICSTRINPUT
		DB	BASICTOKEN
		DW	BASICKEYINPUT
		BASICTOKEN	SET	BASICTOKEN + 1
		;VRIABLE ASSIGNMENT (LET)
		DW	BASICSTRLET
		DB	BASICTOKEN
		DW	BASICKEYLET
		BASICTOKEN	SET	BASICTOKEN + 1
		;MODULUO DIVISION
		DW	BASICSTRMOD
		DB	BASICTOKEN
		DW	BASICKEYMOD
		BASICTOKEN	SET	BASICTOKEN + 1
		;NEXT
		DW	BASICSTRNEXT
		DB	BASICTOKEN
		DW	BASICKEYNEXT
		BASICTOKEN	SET	BASICTOKEN + 1
		;PRINT TO STDIO (PRINT)
		DW	BASICSTRPRINT
		DB	BASICTOKEN
		DW	BASICKEYPRINT
		BASICTOKEN	SET	BASICTOKEN + 1
		;COMMENT (REM)
		DW	BASICSTRREM
		DB	BASICTOKEN
		DW	BASICKEYREM
		BASICTOKEN	SET	BASICTOKEN + 1
		;RETURN
		DW	BASICSTRRETURN
		DB	BASICTOKEN
		DW	BASICKEYRETURN
		BASICTOKEN	SET	BASICTOKEN + 1
		;RANDOM NUMBER (RND)
		DW	BASICSTRRND
		DB	BASICTOKEN
		DW	BASICKEYRND
		BASICTOKEN	SET	BASICTOKEN + 1
		;STOP
		DW	BASICSTRSTOP
		DB	BASICTOKEN
		DW	BASICKEYSTOP
		BASICTOKEN	SET	BASICTOKEN + 1
BASICKEYWORDSEND:

;BITWISE OPERATORS
BASICBITWISE:
	DB	(BASICBITWISEEND - BASICBITWISE) / 5
		;AND
		DW	BASICSTRBAND
		DB	BASICTOKEN
		DW	BASICBITAND
		BASICTOKEN	SET	BASICTOKEN + 1
		;XOR
		DW	BASICSTRBXOR
		DB	BASICTOKEN
		DW	BASICBITXOR
		BASICTOKEN	SET	BASICTOKEN + 1
		;OR
		DW	BASICSTRBOR
		DB	BASICTOKEN
		DW	BASICBITOR
		BASICTOKEN	SET	BASICTOKEN + 1
		;SHIFT LEFT
		DW	BASICSTRSHL
		DB	BASICTOKEN
		DW	BASICBITSHL
		BASICTOKEN	SET	BASICTOKEN + 1
		;SHIFT RIGHT
		DW	BASICSTRSHR
		DB	BASICTOKEN
		DW	BASICBITSHR
		BASICTOKEN	SET	BASICTOKEN + 1
		;ROTATE LEFT
		DW	BASICSTRROL
		DB	BASICTOKEN
		DW	BASICBITROL
		BASICTOKEN	SET	BASICTOKEN + 1
		;ROTATE RIGHT
		DW	BASICSTRROR
		DB	BASICTOKEN
		DW	BASICBITROR
		BASICTOKEN	SET	BASICTOKEN + 1
BASICBITWISEEND:

BASICLOGICS:
	DB	(BASICLOGICSEND - BASICLOGICS) / 5
		;AND
		DW	BASICSTRLAND
		DB	BASICTOKEN
		DW	BASICLOGICAND
		BASICTOKEN	SET	BASICTOKEN + 1
		;OR
		DW	BASICSTRLOR
		DB	BASICTOKEN
		DW	BASICLOGICOR
		BASICTOKEN	SET	BASICTOKEN + 1
BASICLOGICSEND:

;RELATION OPERATORS
BASICRELATIONS:
	DB	(BASICRELATIONSEND - BASICRELATIONS) / 5
		;GREATER THAN OR EQUAL TO
		DW	BASICSTRGREQ
		DB	BASICTOKEN
		DW	BASICRELGREQ
		BASICTOKEN	SET	BASICTOKEN + 1
		;LESS THAN OR EQUAL TO
		DW	BASICSTRLTEQ
		DB	BASICTOKEN
		DW	BASICRELLTEQ
		BASICTOKEN	SET	BASICTOKEN + 1
		;GREATER THAN
		DW	BASICSTRGR
		DB	BASICTOKEN
		DW	BASICRELGR
		BASICTOKEN	SET	BASICTOKEN + 1
		;LESS THAN
		DW	BASICSTRLT
		DB	BASICTOKEN
		DW	BASICRELLT
		BASICTOKEN	SET	BASICTOKEN + 1
		;EQUAL TO
		DW	BASICSTRLEQ
		DB	BASICTOKEN
		DW	BASICRELEQ
		BASICTOKEN	SET	BASICTOKEN + 1
		;NOT EQUAL TO
		DW	BASICSTRLNE
		DB	BASICTOKEN
		DW	BASICRELNE
		BASICTOKEN	SET	BASICTOKEN + 1
BASICRELATIONSEND:

BASICSTRAADD:
	DB	'+', 0x00
BASICSTRABS:
	DB	'ABS', 0x00
BASICSTRADIV:
	DB	'/', 0x00
BASICSTRAFAC:
	DB	'!', 0x00
BASICSTRAMUL:
	DB	'*', 0x00
BASICSTRASS:
	DB	'=', 0x00
BASICSTRASUB:
	DB	'-', 0x00
BASICSTRBAND:
	DB	'&', 0x00
BASICSTRBOR:
	DB	'|', 0x00
BASICSTRBXOR:
	DB	'^', 0x00
BASICSTREXP:
	DB	'EXP', 0x00
BASICSTRFOR:
	DB	'FOR', 0x00
BASICSTRGOSUB:
	DB	'GOSUB', 0x00
BASICSTRGOTO:
	DB	'GOTO', 0x00
BASICSTRGR:
	DB	'>', 0x00
BASICSTRGREQ:
	DB	'>=', 0x00
BASICSTRIF:
	DB	'IF', 0x00
BASICSTRINPUT:
	DB	'INPUT', 0x00
BASICSTRLAND:
	DB	'&&', 0x00
BASICSTRLET:
	DB	'LET', 0x00
BASICSTRLEQ:
	DB	'<', 0x00
BASICSTRLIST:
	DB	'LIST', 0x00
BASICSTRLNE:
	DB	'!=', 0x00
BASICSTRLOR:
	DB	'||', 0x00
BASICSTRLT:
	DB	'<', 0x00
BASICSTRLTEQ:
	DB	'<=', 0x00
BASICSTRMOD:
	DB	'MOD', 0x00
BASICSTRNEW:
	DB	'NEW', 0x00
BASICSTRNEXT:
	DB	'NEXT', 0x00
BASICSTRPRINT:
	DB	'PRINT', 0x00
BASICSTRREM:
	DB	'REM', 0x00
BASICSTRRETURN:
	DB	'RETURN', 0x00
BASICSTRRND:
	DB	'RND', 0x00
BASICSTRROL:
	DB	'<<<', 0x00
BASICSTRROR:
	DB	'>>>', 0x00
BASICSTRRUN:
	DB	'RUN', 0x00
BASICSTRSHL:
	DB	'<<', 0x00
BASICSTRSHR:
	DB	'>>', 0x00
BASICSTRSTOP:
	DB	'STOP', 0x00

;ERROR STRINGS
BASICSTRERRLINENUM:
	DB	'LINE NUMBER EXCEEDS MAXIMUM VALUE', 0x00